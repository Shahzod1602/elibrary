{% extends 'base.html' %}
{% load static %}

{% block title %}AUT E-Library — Knowledge Center{% endblock %}

{% block content %}
<!-- HERO -->
<section class="hero text-center">
    <div class="container position-relative">
        <h1 data-i18n="hero.title">Bilim olish — eng ulug' ibodat</h1>
        <p class="lead" data-i18n="hero.subtitle">603+ kitob, 37 eKitob, raqamli resurslar va ilmiy bazalar bir joyda</p>
        <div class="hero-search">
            <form action="{% url 'catalog' %}" method="GET">
                <div class="input-group">
                    <input type="text" name="q" class="form-control"
                           placeholder="Kitob nomi, muallif yoki ISBN qidiring..."
                           data-i18n-placeholder="hero.placeholder">
                    <button class="btn" type="submit">
                        <i class="bi bi-search"></i> <span data-i18n="hero.search">Qidirish</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- STATS -->
<div class="container">
    <div class="stats-bar" data-aos="fade-up">
        <div class="row">
            <div class="col-4">
                <div class="stat-item">
                    <div class="stat-number">{{ physical_books }}+</div>
                    <div class="stat-label" data-i18n="stats.physicalBooks">Jismoniy kitoblar</div>
                </div>
            </div>
            <div class="col-4">
                <div class="stat-item">
                    <div class="stat-number">{{ ebooks }}</div>
                    <div class="stat-label" data-i18n="stats.ebooks">eKitoblar</div>
                </div>
            </div>
            <div class="col-4">
                <div class="stat-item">
                    <div class="stat-number">{{ total_categories }}</div>
                    <div class="stat-label" data-i18n="stats.categories">Kategoriyalar</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CATEGORIES -->
<section class="container mt-5">
    <div class="section-header" data-aos="fade-up">
        <h2 data-i18n="section.categories">Kategoriyalar</h2>
        <a href="{% url 'catalog' %}"><span data-i18n="section.viewAll">Barchasini ko'rish</span> <i class="bi bi-arrow-right"></i></a>
    </div>
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-3">
        {% for cat in categories %}
        <div class="col" data-aos="fade-up">
            <a href="{% url 'catalog' %}?category={{ cat.id }}" class="text-decoration-none">
                <div class="category-card {% cycle 'cat-teal' 'cat-purple' 'cat-lime' 'cat-gold' 'cat-accent' 'cat-primary' %}">
                    <div class="cat-icon"><i class="bi {{ cat.icon }}"></i></div>
                    <div class="cat-name">{{ cat.name }}</div>
                    <div class="cat-count">{{ cat.book_count }} <span data-i18n="book.count">kitob</span></div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</section>

<!-- NEW BOOKS -->
<section class="container mt-5">
    <div class="section-header" data-aos="fade-up">
        <h2 data-i18n="section.newBooks">Yangi qo'shilgan kitoblar</h2>
        <a href="{% url 'catalog' %}?sort=newest"><span data-i18n="section.viewAll">Barchasini ko'rish</span> <i class="bi bi-arrow-right"></i></a>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        {% for book in new_books %}
        <div class="col" data-aos="fade-up">
            <div class="book-card">
                <a href="{% url 'book_detail' book.pk %}">
                    <div class="card-cover">
                        {% if book.cover %}
                            <img src="{{ book.cover.url }}" alt="{{ book.title }}">
                        {% else %}
                            <div class="card-cover-placeholder">
                                <i class="bi bi-book"></i>
                            </div>
                        {% endif %}
                    </div>
                </a>
                <div class="card-body">
                    <div class="book-title">
                        <a href="{% url 'book_detail' book.pk %}">{{ book.title }}</a>
                    </div>
                    <div class="book-author">{{ book.author }}</div>
                    <div class="card-footer-custom">
                        {% if book.category %}
                            <span class="badge-cat">{{ book.category }}</span>
                        {% endif %}
                        <span class="rating">
                            {% if book.avg_rating %}
                                <i class="bi bi-star-fill"></i> {{ book.avg_rating }}
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- EXHIBITS -->
{% if exhibits %}
<section class="container mt-5">
    <div class="section-header" data-aos="fade-up">
        <h2>EXHIBITS</h2>
    </div>
    <div class="row g-4">
        {% for exhibit in exhibits %}
        <div class="col-lg-6" data-aos="fade-up">
            <div class="exhibit-card" {% if exhibit.image %}style="background-image: url('{{ exhibit.image.url }}');"{% endif %}>
                <div class="exhibit-overlay"></div>
                <div class="exhibit-body">
                    <h3 class="exhibit-title">{{ exhibit.title }}</h3>
                    {% if exhibit.subtitle %}
                        <p class="exhibit-subtitle">{{ exhibit.subtitle }}</p>
                    {% endif %}
                    {% if exhibit.date_start or exhibit.date_end %}
                    <span class="exhibit-date">
                        {% if exhibit.date_start %}{{ exhibit.date_start|date:"M j, Y"|upper }} THROUGH {% endif %}
                        {% if exhibit.date_end %}{{ exhibit.date_end|date:"M j, Y"|upper }}{% endif %}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- UPCOMING EVENTS -->
{% if events %}
<section class="container mt-5">
    <div class="section-header" data-aos="fade-up">
        <h2>UPCOMING EVENTS</h2>
    </div>
    <div class="row g-0">
        {% for event in events %}
        <div class="col-lg-4 {% if not forloop.last %}event-col-border{% endif %}" data-aos="fade-up">
            <div class="event-card">
                <h4 class="event-title">{{ event.title }}</h4>
                {% if event.category %}
                    <p class="event-category">{{ event.category|upper }}</p>
                {% endif %}
                <span class="event-date-badge">{{ event.date|date:"l, M j, Y"|upper }}</span>
                <p class="event-time mt-2 mb-0">
                    {% if event.time_start %}{{ event.time_start|time:"g:i A" }}{% endif %}
                    {% if event.time_start and event.time_end %} - {% endif %}
                    {% if event.time_end %}{{ event.time_end|time:"g:i A" }}{% endif %}
                </p>
                {% if event.location %}
                    <p class="event-location">{{ event.location }}</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- RECENT NEWS -->
{% if recent_news %}
<section class="container mt-5">
    <div class="section-header" data-aos="fade-up">
        <h2>RECENT NEWS</h2>
    </div>
    <div class="row g-0">
        {% for item in recent_news %}
        <div class="col-lg-6 {% if not forloop.last %}news-col-border{% endif %}" data-aos="fade-up">
            <div class="news-card">
                {% if item.image %}
                <img src="{{ item.image.url }}" alt="{{ item.title }}" class="news-thumb">
                {% endif %}
                <div class="news-body">
                    <p class="news-date">{{ item.date|date:"F j, Y" }}</p>
                    <h5 class="news-title">{{ item.title }}</h5>
                    <p class="news-desc">{{ item.description|truncatewords:25 }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- POPULAR BOOKS -->
<section class="container mt-5 mb-4">
    <div class="section-header" data-aos="fade-up">
        <h2 data-i18n="section.popularBooks">Mashhur kitoblar</h2>
        <a href="{% url 'catalog' %}?sort=popular"><span data-i18n="section.viewAll">Barchasini ko'rish</span> <i class="bi bi-arrow-right"></i></a>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        {% for book in popular_books %}
        <div class="col" data-aos="fade-up">
            <div class="book-card">
                <a href="{% url 'book_detail' book.pk %}">
                    <div class="card-cover">
                        {% if book.cover %}
                            <img src="{{ book.cover.url }}" alt="{{ book.title }}">
                        {% else %}
                            <div class="card-cover-placeholder">
                                <i class="bi bi-book"></i>
                            </div>
                        {% endif %}
                    </div>
                </a>
                <div class="card-body">
                    <div class="book-title">
                        <a href="{% url 'book_detail' book.pk %}">{{ book.title }}</a>
                    </div>
                    <div class="book-author">{{ book.author }}</div>
                    <div class="card-footer-custom">
                        {% if book.category %}
                            <span class="badge-cat">{{ book.category }}</span>
                        {% endif %}
                        <span class="rating">
                            <i class="bi bi-eye"></i> {{ book.views_count }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}
